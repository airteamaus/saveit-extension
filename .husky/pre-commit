echo "üîç Running pre-commit checks..."

# Run linter
echo "  ‚Üí Linting..."
npm run lint || {
  echo "‚ùå Linting failed. Run 'npm run lint:fix' to fix issues."
  exit 1
}

# Validate manifest
echo "  ‚Üí Validating manifest..."
npx web-ext lint --source-dir=. --ignore-files="node_modules/**" --ignore-files="scripts/**" --ignore-files="tests/**" --ignore-files="coverage/**" || {
  echo "‚ùå Manifest validation failed (warnings OK for now)."
  # Don't fail on warnings - web-ext lint has many false positives
  true
}

# Run tests
echo "  ‚Üí Running tests..."
npm test || {
  echo "‚ùå Tests failed. Fix tests before committing."
  exit 1
}

# Check for console.log in production code (warning only)
if git diff --cached --name-only | grep -E '\.(js)$' | xargs grep -n "console\.log" 2>/dev/null | grep -v "console.error" | grep -v "test\.js" | grep -v "mock-data\.js"; then
  echo "‚ö†Ô∏è  Warning: console.log statements found. Consider removing for production."
fi

echo "‚úÖ Pre-commit checks passed!"
