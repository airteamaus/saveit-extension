echo "üîç Running pre-commit checks..."

# Run linter
echo "  ‚Üí Linting..."
pnpm run lint || {
  echo "‚ùå Linting failed. Run 'pnpm run lint:fix' to fix issues."
  exit 1
}

# Validate manifest (uses same exclusions as pnpm run validate)
echo "  ‚Üí Validating manifest..."
pnpm run validate || {
  echo "‚ùå Manifest validation failed (warnings OK for now)."
  # Don't fail on warnings - web-ext lint has many false positives
  true
}

# Run tests
echo "  ‚Üí Running tests..."
pnpm test || {
  echo "‚ùå Tests failed. Fix tests before committing."
  exit 1
}

# Check for console.log in production code (warning only)
if git diff --cached --name-only | grep -E '\.(js)$' | xargs grep -n "console\.log" 2>/dev/null | grep -v "console.error" | grep -v "test\.js" | grep -v "mock-data\.js"; then
  echo "‚ö†Ô∏è  Warning: console.log statements found. Consider removing for production."
fi

echo "‚úÖ Pre-commit checks passed!"
